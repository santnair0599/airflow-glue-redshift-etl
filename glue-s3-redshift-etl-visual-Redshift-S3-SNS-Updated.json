{
	"jobConfig": {
		"name": "glue-s3-redshift-etl-visual-Redshift-S3-SNS-Updated",
		"description": "visual etl for connecting  to S3 and loading to Redshift",
		"role": "arn:aws:iam::019824224614:role/AWSGlueRedshiftSecretRole",
		"command": "glueetl",
		"version": "5.0",
		"runtime": null,
		"workerType": "G.1X",
		"numberOfWorkers": 3,
		"maxCapacity": 3,
		"jobRunQueuingEnabled": false,
		"maxRetries": 1,
		"timeout": 60,
		"maxConcurrentRuns": 1,
		"delay": 30,
		"security": "none",
		"scriptName": "glue-s3-redshift-etl-visual-Redshift-S3-SNS-Updated.py",
		"scriptLocation": "s3://aws-glue-assets-019824224614-us-east-1/scripts/",
		"language": "python-3",
		"spark": true,
		"sparkConfiguration": "standard",
		"jobParameters": [
			{
				"key": "--Connections",
				"value": "glue-s3-redshift-connection",
				"existing": false
			}
		],
		"tags": [],
		"jobMode": "VISUAL_MODE",
		"createdOn": "2025-04-02T20:16:15.484Z",
		"developerMode": false,
		"connectionsList": [
			"Redshift-connection-provisioned",
			"glue-s3-redshift-connection"
		],
		"temporaryDirectory": "s3://aws-glue-assets-019824224614-us-east-1/temporary/",
		"etlAutoScaling": true,
		"logging": true,
		"glueHiveMetastore": true,
		"etlAutoTuning": true,
		"metrics": true,
		"observabilityMetrics": true,
		"bookmark": "job-bookmark-enable",
		"sparkPath": "s3://aws-glue-assets-019824224614-us-east-1/sparkHistoryLogs/",
		"flexExecution": false,
		"minFlexWorkers": null,
		"maintenanceWindow": null
	},
	"dag": {
		"node-1743500218874": {
			"nodeId": "node-1743500218874",
			"dataPreview": false,
			"previewAmount": 0,
			"inputs": [],
			"name": "Amazon S3",
			"generatedNodeName": "AmazonS3_node1743500218874",
			"classification": "DataSource",
			"type": "S3",
			"isCatalog": false,
			"format": "csv",
			"paths": [
				"s3://kaggle-dataset-019824224614/raw/"
			],
			"compressionType": null,
			"exclusions": [],
			"groupFiles": null,
			"groupSize": null,
			"recurse": true,
			"maxBand": null,
			"maxFilesInBand": null,
			"additionalOptions": {
				"boundedSize": null,
				"boundedFiles": null,
				"enableSamplePath": false,
				"samplePath": "s3://kaggle-dataset-019824224614/raw/Telco_customer_churn.csv",
				"boundedOption": null
			},
			"separator": ",",
			"escaper": "",
			"quoteChar": "\"",
			"multiline": null,
			"withHeader": true,
			"writeHeader": null,
			"skipFirst": null,
			"optimizePerformance": false,
			"outputSchemas": [
				[
					{
						"key": "customerid",
						"fullPath": [
							"customerid"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "country",
						"fullPath": [
							"country"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "state",
						"fullPath": [
							"state"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "city",
						"fullPath": [
							"city"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "zip code",
						"fullPath": [
							"zip code"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "lat long",
						"fullPath": [
							"lat long"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "latitude",
						"fullPath": [
							"latitude"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "longitude",
						"fullPath": [
							"longitude"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "gender",
						"fullPath": [
							"gender"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "senior citizen",
						"fullPath": [
							"senior citizen"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "partner",
						"fullPath": [
							"partner"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "dependents",
						"fullPath": [
							"dependents"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "tenure months",
						"fullPath": [
							"tenure months"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "phone service",
						"fullPath": [
							"phone service"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "multiple lines",
						"fullPath": [
							"multiple lines"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "internet service",
						"fullPath": [
							"internet service"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "online security",
						"fullPath": [
							"online security"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "online backup",
						"fullPath": [
							"online backup"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "device protection",
						"fullPath": [
							"device protection"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "tech support",
						"fullPath": [
							"tech support"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "streaming tv",
						"fullPath": [
							"streaming tv"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "streaming movies",
						"fullPath": [
							"streaming movies"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "contract",
						"fullPath": [
							"contract"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "paperless billing",
						"fullPath": [
							"paperless billing"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "payment method",
						"fullPath": [
							"payment method"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "monthly charges",
						"fullPath": [
							"monthly charges"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "total charges",
						"fullPath": [
							"total charges"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "churn label",
						"fullPath": [
							"churn label"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "churn value",
						"fullPath": [
							"churn value"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "churn score",
						"fullPath": [
							"churn score"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "cltv",
						"fullPath": [
							"cltv"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "churn reason",
						"fullPath": [
							"churn reason"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "ingestion_date",
						"fullPath": [
							"ingestion_date"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					}
				]
			],
			"calculatedType": "",
			"codeGenVersion": 2
		},
		"node-1743505539671": {
			"nodeId": "node-1743505539671",
			"dataPreview": false,
			"previewAmount": 0,
			"inputs": [
				"node-1743503694325"
			],
			"name": "Select From Collection - collect load date",
			"generatedNodeName": "SelectFromCollectioncollectloaddate_node1743505539671",
			"classification": "Transform",
			"type": "SelectFromCollection",
			"index": 0,
			"parentsValid": true,
			"calculatedType": "",
			"codeGenVersion": 2
		},
		"node-1743500646591": {
			"nodeId": "node-1743500646591",
			"dataPreview": false,
			"previewAmount": 0,
			"inputs": [
				"node-1743500227998"
			],
			"name": "Amazon Redshift",
			"generatedNodeName": "AmazonRedshift_node1743500646591",
			"classification": "DataSink",
			"type": "AmazonRedshift",
			"streamingBatchInterval": 100,
			"data": {
				"accessType": "connection",
				"sourceType": "table",
				"connection": {
					"value": "Redshift-connection-provisioned",
					"label": "Redshift-connection-provisioned",
					"description": "No description available. Version: 2"
				},
				"schema": {
					"value": "public",
					"label": "public",
					"description": null
				},
				"catalogDatabase": null,
				"catalogRedshiftTable": null,
				"catalogRedshiftSchema": null,
				"table": {
					"value": "customer_churn_optimized",
					"label": "customer_churn_optimized",
					"description": null
				},
				"catalogTable": null,
				"tempDir": "s3://kaggle-dataset-019824224614/temp/",
				"iamRole": {
					"value": null,
					"label": "AWSGlueRedshiftSecretRole",
					"description": "Allows Glue to call AWS services on your behalf. "
				},
				"sampleQuery": null,
				"preAction": null,
				"postAction": null,
				"action": "append",
				"tableSchema": [
					{
						"value": "customerid",
						"label": "customerid",
						"description": "VARCHAR"
					},
					{
						"value": "country",
						"label": "country",
						"description": "VARCHAR"
					},
					{
						"value": "state",
						"label": "state",
						"description": "VARCHAR"
					},
					{
						"value": "city",
						"label": "city",
						"description": "VARCHAR"
					},
					{
						"value": "zip_code",
						"label": "zip_code",
						"description": "INTEGER"
					},
					{
						"value": "lat_long",
						"label": "lat_long",
						"description": "VARCHAR"
					},
					{
						"value": "latitude",
						"label": "latitude",
						"description": "DECIMAL"
					},
					{
						"value": "longitude",
						"label": "longitude",
						"description": "DECIMAL"
					},
					{
						"value": "gender",
						"label": "gender",
						"description": "VARCHAR"
					},
					{
						"value": "senior_citizen",
						"label": "senior_citizen",
						"description": "VARCHAR"
					},
					{
						"value": "partner",
						"label": "partner",
						"description": "VARCHAR"
					},
					{
						"value": "dependents",
						"label": "dependents",
						"description": "VARCHAR"
					},
					{
						"value": "tenure_months",
						"label": "tenure_months",
						"description": "INTEGER"
					},
					{
						"value": "phone_service",
						"label": "phone_service",
						"description": "VARCHAR"
					},
					{
						"value": "multiple_lines",
						"label": "multiple_lines",
						"description": "VARCHAR"
					},
					{
						"value": "internet_service",
						"label": "internet_service",
						"description": "VARCHAR"
					},
					{
						"value": "online_security",
						"label": "online_security",
						"description": "VARCHAR"
					},
					{
						"value": "online_backup",
						"label": "online_backup",
						"description": "VARCHAR"
					},
					{
						"value": "device_protection",
						"label": "device_protection",
						"description": "VARCHAR"
					},
					{
						"value": "tech_support",
						"label": "tech_support",
						"description": "VARCHAR"
					},
					{
						"value": "streaming_tv",
						"label": "streaming_tv",
						"description": "VARCHAR"
					},
					{
						"value": "streaming_movies",
						"label": "streaming_movies",
						"description": "VARCHAR"
					},
					{
						"value": "contract",
						"label": "contract",
						"description": "VARCHAR"
					},
					{
						"value": "paperless_billing",
						"label": "paperless_billing",
						"description": "VARCHAR"
					},
					{
						"value": "payment_method",
						"label": "payment_method",
						"description": "VARCHAR"
					},
					{
						"value": "monthly_charges",
						"label": "monthly_charges",
						"description": "DECIMAL"
					},
					{
						"value": "total_charges",
						"label": "total_charges",
						"description": "DECIMAL"
					},
					{
						"value": "churn_label",
						"label": "churn_label",
						"description": "VARCHAR"
					},
					{
						"value": "churn_value",
						"label": "churn_value",
						"description": "INTEGER"
					},
					{
						"value": "churn_score",
						"label": "churn_score",
						"description": "INTEGER"
					},
					{
						"value": "cltv",
						"label": "cltv",
						"description": "INTEGER"
					},
					{
						"value": "churn_reason",
						"label": "churn_reason",
						"description": "VARCHAR"
					},
					{
						"value": "ingestion_date",
						"label": "ingestion_date",
						"description": "DATE"
					},
					{
						"value": "load_date",
						"label": "load_date",
						"description": "DATE"
					}
				],
				"selectedColumns": [
					{
						"value": "customerid",
						"label": "customerid",
						"description": "VARCHAR"
					}
				],
				"crawlerConnection": null,
				"tablePrefix": null,
				"upsert": true,
				"mergeAction": "simple",
				"mergeWhenMatched": "update",
				"mergeWhenNotMatched": "insert",
				"mergeClause": null,
				"stagingTable": "public.customer_churn_optimized_temp_jzqchl",
				"advancedOptions": []
			},
			"calculatedType": "",
			"codeGenVersion": 2
		},
		"node-1743500227998": {
			"nodeId": "node-1743500227998",
			"dataPreview": false,
			"previewAmount": 0,
			"inputs": [
				"node-1743505539671"
			],
			"name": "Change Schema - load date",
			"generatedNodeName": "ChangeSchemaloaddate_node1743500227998",
			"classification": "Transform",
			"type": "ApplyMapping",
			"mapping": [
				{
					"toKey": "customerid",
					"fromPath": [
						"customerid"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "count",
					"fromPath": [
						"count"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": true,
					"children": null
				},
				{
					"toKey": "country",
					"fromPath": [
						"country"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "state",
					"fromPath": [
						"state"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "city",
					"fromPath": [
						"city"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "zip_code",
					"fromPath": [
						"zip_code"
					],
					"toType": "int",
					"fromType": "int",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "lat_long",
					"fromPath": [
						"lat_long"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "latitude",
					"fromPath": [
						"latitude"
					],
					"toType": "decimal",
					"fromType": "decimal",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "longitude",
					"fromPath": [
						"longitude"
					],
					"toType": "decimal",
					"fromType": "decimal",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "gender",
					"fromPath": [
						"gender"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "senior_citizen",
					"fromPath": [
						"senior_citizen"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "partner",
					"fromPath": [
						"partner"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "dependents",
					"fromPath": [
						"dependents"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "tenure_months",
					"fromPath": [
						"tenure_months"
					],
					"toType": "int",
					"fromType": "int",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "phone_service",
					"fromPath": [
						"phone_service"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "multiple_lines",
					"fromPath": [
						"multiple_lines"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "internet_service",
					"fromPath": [
						"internet_service"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "online_security",
					"fromPath": [
						"online_security"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "online_backup",
					"fromPath": [
						"online_backup"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "device_protection",
					"fromPath": [
						"device_protection"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "tech_support",
					"fromPath": [
						"tech_support"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "streaming_tv",
					"fromPath": [
						"streaming_tv"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "streaming_movies",
					"fromPath": [
						"streaming_movies"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "contract",
					"fromPath": [
						"contract"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "paperless_billing",
					"fromPath": [
						"paperless_billing"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "payment_method",
					"fromPath": [
						"payment_method"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "monthly_charges",
					"fromPath": [
						"monthly_charges"
					],
					"toType": "decimal",
					"fromType": "decimal",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "total_charges",
					"fromPath": [
						"total_charges"
					],
					"toType": "decimal",
					"fromType": "decimal",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "churn_label",
					"fromPath": [
						"churn_label"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "churn_value",
					"fromPath": [
						"churn_value"
					],
					"toType": "int",
					"fromType": "int",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "churn_score",
					"fromPath": [
						"churn_score"
					],
					"toType": "int",
					"fromType": "int",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "cltv",
					"fromPath": [
						"cltv"
					],
					"toType": "int",
					"fromType": "int",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "churn_reason",
					"fromPath": [
						"churn_reason"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "ingestion_date",
					"fromPath": [
						"ingestion_date"
					],
					"toType": "date",
					"fromType": "date",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "load_date",
					"fromPath": [
						"load_date"
					],
					"toType": "date",
					"fromType": "date",
					"dropped": false,
					"children": null
				}
			],
			"parentsValid": true,
			"calculatedType": "",
			"codeGenVersion": 2
		},
		"node-1743503694325": {
			"nodeId": "node-1743503694325",
			"dataPreview": false,
			"previewAmount": 0,
			"inputs": [
				"node-1743500218874"
			],
			"name": "Custom Transform - add load_date",
			"generatedNodeName": "CustomTransformaddload_date_node1743503694325",
			"classification": "Transform",
			"type": "CustomCode",
			"code": "import boto3\nimport re\nfrom pyspark.sql.functions import current_date, to_date, col\nfrom pyspark.sql.types import IntegerType, DecimalType\nfrom awsglue.dynamicframe import DynamicFrame, DynamicFrameCollection\n\n# ‚úÖ Get Spark session\nspark = glueContext.spark_session\n\n# ‚úÖ SNS client (reuse throughout the function)\nsns_client = boto3.client(\"sns\")\nsns_topic_arn = \"arn:aws:sns:us-east-1:019824224614:glue-s3-redshift-customer-churn-topic\"\n\n# ‚úÖ Define expected schema\nexpected = set([\n    \"customerid\", \"country\", \"state\", \"city\", \"zip_code\", \"lat_long\", \"latitude\", \"longitude\",\n    \"gender\", \"senior_citizen\", \"partner\", \"dependents\", \"tenure_months\", \"phone_service\",\n    \"multiple_lines\", \"internet_service\", \"online_security\", \"online_backup\", \"device_protection\",\n    \"tech_support\", \"streaming_tv\", \"streaming_movies\", \"contract\", \"paperless_billing\",\n    \"payment_method\", \"monthly_charges\", \"total_charges\", \"churn_label\", \"churn_value\",\n    \"churn_score\", \"cltv\", \"churn_reason\", \"ingestion_date\", \"load_date\"\n])\n\n# ‚úÖ Read input\ninput_dyf = dfc.select(list(dfc.keys())[0])\ndf = input_dyf.toDF()\n\n# ‚úÖ Normalize column names\noriginal_cols = df.columns\nrenamed_cols = [re.sub(r'_+$', '', re.sub(r'\\W+', '_', c.strip().lower())) for c in original_cols]\ndf = df.toDF(*renamed_cols)\n\n# üîç Log and notify normalized columns\nprint(\"üì• Original Columns:\", original_cols)\nprint(\"‚úÖ Renamed Columns:\", df.columns)\n\n\n# ‚úÖ Type Casting\nint_columns = [\"zip_code\", \"tenure_months\", \"churn_value\", \"churn_score\", \"cltv\"]\nfor col_name in int_columns:\n    if col_name in df.columns:\n        df = df.withColumn(col_name, col(col_name).cast(IntegerType()))\n\ndecimal_columns = [\"latitude\", \"longitude\", \"monthly_charges\", \"total_charges\"]\nfor col_name in decimal_columns:\n    if col_name in df.columns:\n        df = df.withColumn(col_name, col(col_name).cast(DecimalType(30, 10)))\n\n# ‚úÖ Parse ingestion_date\nspark.conf.set(\"spark.sql.legacy.timeParserPolicy\", \"LEGACY\")\ndf = df.withColumn(\"ingestion_date\", to_date(col(\"ingestion_date\"), \"M/d/yyyy\"))\ndf = df.filter(col(\"ingestion_date\").isNotNull())\n\n# ‚úÖ Add load_date\ndf = df.withColumn(\"load_date\", current_date())\nsns_client.publish(\n    TopicArn=sns_topic_arn,\n    Subject=\"‚ÑπÔ∏è GLUE SCHEMA NORMALIZED\",\n    Message=f\"Final Columns: {df.columns}\"\n)\n# ‚úÖ Schema validation\nactual = set(df.columns)\nmissing = expected - actual\nextra = actual - expected\n\nprint(\"üõë Missing Columns:\", sorted(missing))\nprint(\"‚ö†Ô∏è Extra Columns:\", sorted(extra))\n\nif missing:\n    message = f\"‚ùå Missing Columns:\\n{', '.join(sorted(missing))}\\n\"\n    if extra:\n        message += f\"‚ö†Ô∏è Extra Columns:\\n{', '.join(sorted(extra))}\\n\"\n    sns_client.publish(\n        TopicArn=sns_topic_arn,\n        Subject=\"üõë GLUE SCHEMA VALIDATION ALERT\",\n        Message=message\n    )\n    raise Exception(\"‚ùå Job Failed due to missing required columns.\")\n\nif extra:\n    message = f\"‚ö†Ô∏è Extra Columns Present (but proceeding):\\n{', '.join(sorted(extra))}\\n\"\n    sns_client.publish(\n        TopicArn=sns_topic_arn,\n        Subject=\"‚ö†Ô∏è GLUE SCHEMA WARNING - Extra Columns\",\n        Message=message\n    )\n\n# ‚úÖ Convert to DynamicFrame\ncleaned_dyf = DynamicFrame.fromDF(df, glueContext, \"CleanedFrame\")\nreturn DynamicFrameCollection({\"output\": cleaned_dyf}, glueContext)    ",
			"className": "data_load",
			"outputSchemas": [
				[
					{
						"key": "customerid",
						"fullPath": [
							"customerid"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "count",
						"fullPath": [
							"count"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "country",
						"fullPath": [
							"country"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "state",
						"fullPath": [
							"state"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "city",
						"fullPath": [
							"city"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "zip_code",
						"fullPath": [
							"zip_code"
						],
						"type": "int",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "lat_long",
						"fullPath": [
							"lat_long"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "latitude",
						"fullPath": [
							"latitude"
						],
						"type": "decimal",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "longitude",
						"fullPath": [
							"longitude"
						],
						"type": "decimal",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "gender",
						"fullPath": [
							"gender"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "senior_citizen",
						"fullPath": [
							"senior_citizen"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "partner",
						"fullPath": [
							"partner"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "dependents",
						"fullPath": [
							"dependents"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "tenure_months",
						"fullPath": [
							"tenure_months"
						],
						"type": "int",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "phone_service",
						"fullPath": [
							"phone_service"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "multiple_lines",
						"fullPath": [
							"multiple_lines"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "internet_service",
						"fullPath": [
							"internet_service"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "online_security",
						"fullPath": [
							"online_security"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "online_backup",
						"fullPath": [
							"online_backup"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "device_protection",
						"fullPath": [
							"device_protection"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "tech_support",
						"fullPath": [
							"tech_support"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "streaming_tv",
						"fullPath": [
							"streaming_tv"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "streaming_movies",
						"fullPath": [
							"streaming_movies"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "contract",
						"fullPath": [
							"contract"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "paperless_billing",
						"fullPath": [
							"paperless_billing"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "payment_method",
						"fullPath": [
							"payment_method"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "monthly_charges",
						"fullPath": [
							"monthly_charges"
						],
						"type": "decimal",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "total_charges",
						"fullPath": [
							"total_charges"
						],
						"type": "decimal",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "churn_label",
						"fullPath": [
							"churn_label"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "churn_value",
						"fullPath": [
							"churn_value"
						],
						"type": "int",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "churn_score",
						"fullPath": [
							"churn_score"
						],
						"type": "int",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "cltv",
						"fullPath": [
							"cltv"
						],
						"type": "int",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "churn_reason",
						"fullPath": [
							"churn_reason"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "ingestion_date",
						"fullPath": [
							"ingestion_date"
						],
						"type": "date",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "load_date",
						"fullPath": [
							"load_date"
						],
						"type": "date",
						"glueStudioType": null,
						"children": null
					}
				]
			],
			"parentsValid": true,
			"calculatedType": "",
			"codeGenVersion": 2
		},
		"node-1743541972900": {
			"nodeId": "node-1743541972900",
			"dataPreview": false,
			"previewAmount": 0,
			"inputs": [
				"node-1743505539671"
			],
			"name": "Custom Transform - Partition",
			"generatedNodeName": "CustomTransformPartition_node1743541972900",
			"classification": "Transform",
			"type": "CustomCode",
			"code": "import boto3\nimport re\nfrom pyspark.sql.functions import current_date, to_date, col, year, month\nfrom pyspark.sql.types import IntegerType, DecimalType\nfrom awsglue.dynamicframe import DynamicFrame, DynamicFrameCollection\n\nspark = glueContext.spark_session\nsns_client = boto3.client(\"sns\")\nsns_topic_arn = \"arn:aws:sns:us-east-1:019824224614:glue-s3-redshift-customer-churn-topic\"\n\n\n\n# ‚úÖ Correct: Select by known key (e.g. CleanedFrame)\ninput_dyf = dfc.select(\"CleanedFrame\")\ndf = input_dyf.toDF()\n\noriginal_cols = df.columns\nrenamed_cols = [re.sub(r'_+$', '', re.sub(r'\\W+', '_', c.strip().lower())) for c in original_cols]\ndf = df.toDF(*renamed_cols)\n\n# Cast columns\n...\n\nspark.conf.set(\"spark.sql.legacy.timeParserPolicy\", \"LEGACY\")\nif \"ingestion_date\" in df.columns:\n    df = df.withColumn(\"ingestion_date\", to_date(col(\"ingestion_date\"), \"M/d/yyyy\"))\n    df = df.filter(col(\"ingestion_date\").isNotNull())\n    df = df.withColumn(\"year\", year(col(\"ingestion_date\")))\n    df = df.withColumn(\"month\", month(col(\"ingestion_date\")))\nelse:\n    sns_client.publish(\n        TopicArn=sns_topic_arn,\n        Subject=\"üõë GLUE PARTITIONING FAILED\",\n        Message=\"‚ùå ingestion_date column is missing. Cannot proceed with partitioning.\"\n    )\n    raise Exception(\"‚ùå ingestion_date column missing\")\n\ndf = df.withColumn(\"load_date\", current_date())\n...\n\nenriched_dyf = DynamicFrame.fromDF(df, glueContext, \"EnrichedPartitionedDF\")\nreturn DynamicFrameCollection({\"output\": enriched_dyf}, glueContext)",
			"className": "partition_date",
			"outputSchemas": [
				[
					{
						"key": "customerid",
						"fullPath": [
							"customerid"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "count",
						"fullPath": [
							"count"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "country",
						"fullPath": [
							"country"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "state",
						"fullPath": [
							"state"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "city",
						"fullPath": [
							"city"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "zip_code",
						"fullPath": [
							"zip_code"
						],
						"type": "int",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "lat_long",
						"fullPath": [
							"lat_long"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "latitude",
						"fullPath": [
							"latitude"
						],
						"type": "decimal",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "longitude",
						"fullPath": [
							"longitude"
						],
						"type": "decimal",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "gender",
						"fullPath": [
							"gender"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "senior_citizen",
						"fullPath": [
							"senior_citizen"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "partner",
						"fullPath": [
							"partner"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "dependents",
						"fullPath": [
							"dependents"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "tenure_months",
						"fullPath": [
							"tenure_months"
						],
						"type": "int",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "phone_service",
						"fullPath": [
							"phone_service"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "multiple_lines",
						"fullPath": [
							"multiple_lines"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "internet_service",
						"fullPath": [
							"internet_service"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "online_security",
						"fullPath": [
							"online_security"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "online_backup",
						"fullPath": [
							"online_backup"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "device_protection",
						"fullPath": [
							"device_protection"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "tech_support",
						"fullPath": [
							"tech_support"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "streaming_tv",
						"fullPath": [
							"streaming_tv"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "streaming_movies",
						"fullPath": [
							"streaming_movies"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "contract",
						"fullPath": [
							"contract"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "paperless_billing",
						"fullPath": [
							"paperless_billing"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "payment_method",
						"fullPath": [
							"payment_method"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "monthly_charges",
						"fullPath": [
							"monthly_charges"
						],
						"type": "decimal",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "total_charges",
						"fullPath": [
							"total_charges"
						],
						"type": "decimal",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "churn_label",
						"fullPath": [
							"churn_label"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "churn_value",
						"fullPath": [
							"churn_value"
						],
						"type": "int",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "churn_score",
						"fullPath": [
							"churn_score"
						],
						"type": "int",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "cltv",
						"fullPath": [
							"cltv"
						],
						"type": "int",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "churn_reason",
						"fullPath": [
							"churn_reason"
						],
						"type": "string",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "ingestion_date",
						"fullPath": [
							"ingestion_date"
						],
						"type": "date",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "year",
						"fullPath": [
							"year"
						],
						"type": "int",
						"glueStudioType": null,
						"children": null
					},
					{
						"key": "month",
						"fullPath": [
							"month"
						],
						"type": "int",
						"glueStudioType": null,
						"children": null
					}
				]
			],
			"parentsValid": true,
			"calculatedType": "",
			"codeGenVersion": 2
		},
		"node-1743542109183": {
			"nodeId": "node-1743542109183",
			"dataPreview": false,
			"previewAmount": 0,
			"inputs": [
				"node-1743541972900"
			],
			"name": "Select From Collection - Partition",
			"generatedNodeName": "SelectFromCollectionPartition_node1743542109183",
			"classification": "Transform",
			"type": "SelectFromCollection",
			"index": 0,
			"parentsValid": true,
			"calculatedType": "",
			"codeGenVersion": 2
		},
		"node-1743625974284": {
			"nodeId": "node-1743625974284",
			"dataPreview": false,
			"previewAmount": 0,
			"inputs": [
				"node-1743542109183"
			],
			"name": "Change Schema - Partition",
			"generatedNodeName": "ChangeSchemaPartition_node1743625974284",
			"classification": "Transform",
			"type": "ApplyMapping",
			"mapping": [
				{
					"toKey": "customerid",
					"fromPath": [
						"customerid"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "count",
					"fromPath": [
						"count"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": true,
					"children": null
				},
				{
					"toKey": "country",
					"fromPath": [
						"country"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "state",
					"fromPath": [
						"state"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "city",
					"fromPath": [
						"city"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "zip_code",
					"fromPath": [
						"zip_code"
					],
					"toType": "int",
					"fromType": "int",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "lat_long",
					"fromPath": [
						"lat_long"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "latitude",
					"fromPath": [
						"latitude"
					],
					"toType": "decimal",
					"fromType": "decimal",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "longitude",
					"fromPath": [
						"longitude"
					],
					"toType": "decimal",
					"fromType": "decimal",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "gender",
					"fromPath": [
						"gender"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "senior_citizen",
					"fromPath": [
						"senior_citizen"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "partner",
					"fromPath": [
						"partner"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "dependents",
					"fromPath": [
						"dependents"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "tenure_months",
					"fromPath": [
						"tenure_months"
					],
					"toType": "int",
					"fromType": "int",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "phone_service",
					"fromPath": [
						"phone_service"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "multiple_lines",
					"fromPath": [
						"multiple_lines"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "internet_service",
					"fromPath": [
						"internet_service"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "online_security",
					"fromPath": [
						"online_security"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "online_backup",
					"fromPath": [
						"online_backup"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "device_protection",
					"fromPath": [
						"device_protection"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "tech_support",
					"fromPath": [
						"tech_support"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "streaming_tv",
					"fromPath": [
						"streaming_tv"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "streaming_movies",
					"fromPath": [
						"streaming_movies"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "contract",
					"fromPath": [
						"contract"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "paperless_billing",
					"fromPath": [
						"paperless_billing"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "payment_method",
					"fromPath": [
						"payment_method"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "monthly_charges",
					"fromPath": [
						"monthly_charges"
					],
					"toType": "decimal",
					"fromType": "decimal",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "total_charges",
					"fromPath": [
						"total_charges"
					],
					"toType": "decimal",
					"fromType": "decimal",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "churn_label",
					"fromPath": [
						"churn_label"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "churn_value",
					"fromPath": [
						"churn_value"
					],
					"toType": "int",
					"fromType": "int",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "churn_score",
					"fromPath": [
						"churn_score"
					],
					"toType": "int",
					"fromType": "int",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "cltv",
					"fromPath": [
						"cltv"
					],
					"toType": "int",
					"fromType": "int",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "churn_reason",
					"fromPath": [
						"churn_reason"
					],
					"toType": "string",
					"fromType": "string",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "ingestion_date",
					"fromPath": [
						"ingestion_date"
					],
					"toType": "date",
					"fromType": "date",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "year",
					"fromPath": [
						"year"
					],
					"toType": "int",
					"fromType": "int",
					"dropped": false,
					"children": null
				},
				{
					"toKey": "month",
					"fromPath": [
						"month"
					],
					"toType": "int",
					"fromType": "int",
					"dropped": false,
					"children": null
				}
			],
			"parentsValid": true,
			"calculatedType": "",
			"codeGenVersion": 2
		},
		"node-1743542157636": {
			"nodeId": "node-1743542157636",
			"dataPreview": false,
			"previewAmount": 0,
			"inputs": [
				"node-1743625974284"
			],
			"name": "Amazon S3 - partition",
			"generatedNodeName": "AmazonS3partition_node1743542157636",
			"classification": "DataSink",
			"type": "S3",
			"streamingBatchInterval": 100,
			"format": "glueparquet",
			"compression": "snappy",
			"path": "s3://kaggle-dataset-019824224614/staging/",
			"partitionKeys": [
				"year",
				"month"
			],
			"schemaChangePolicy": {
				"enableUpdateCatalog": true,
				"updateBehavior": "UPDATE_IN_DATABASE",
				"database": "customer-churn-s3-glue-database-yml",
				"table": "customer-churn-partitioned-table"
			},
			"updateCatalogOptions": "schemaAndPartitions",
			"autoDataQuality": {
				"isEnabled": true,
				"evaluationContext": "EvaluateDataQuality_node1743541939216"
			},
			"calculatedType": "",
			"codeGenVersion": 2
		}
	},
	"hasBeenSaved": false,
	"usageProfileName": null
}